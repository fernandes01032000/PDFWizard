<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>DocsHgumba - Sistema de PDFs Editáveis</title>

    <!-- Bootstrap 5.0 CSS (Local) -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/bootstrap-icons.css">

    <!-- PDF.js (Local) -->
    <script src="assets/js/pdf.min.js"></script>

    <!-- PDF-lib (Local) -->
    <script src="assets/js/pdf-lib.min.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-light">

    <!-- Header -->
    <nav class="navbar navbar-dark bg-army-green shadow-sm sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <i class="bi bi-file-earmark-pdf fs-3 me-2"></i>
                <div class="d-none d-sm-block">
                    <h1 class="h5 mb-0">DocsHgumba</h1>
                    <small class="text-white-50 d-none d-md-inline">Sistema 100% Offline de PDFs Editáveis</small>
                </div>
                <div class="d-sm-none">
                    <h1 class="h6 mb-0">DocsHgumba</h1>
                </div>
            </a>
            <div class="d-flex align-items-center gap-2">
                <span class="badge bg-success d-none d-sm-inline">
                    <i class="bi bi-circle-fill"></i> Offline
                </span>
                <button class="btn btn-sm btn-outline-light d-lg-none" id="mobile-menu-toggle">
                    <i class="bi bi-list fs-5"></i>
                </button>
                <button class="btn btn-sm btn-outline-light" id="theme-toggle" title="Alternar tema">
                    <i class="bi bi-moon-stars"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container-fluid p-0">

        <!-- Mode Tabs -->
        <ul class="nav nav-tabs bg-white sticky-tabs shadow-sm" id="modeTabs" role="tablist">
            <li class="nav-item flex-fill" role="presentation">
                <button class="nav-link active w-100 text-center" id="design-tab" data-bs-toggle="tab" data-bs-target="#design-mode"
                        type="button" role="tab" onclick="switchMode('design')">
                    <i class="bi bi-pencil-square me-1"></i>
                    <span class="d-none d-sm-inline">Modo </span>Design
                </button>
            </li>
            <li class="nav-item flex-fill" role="presentation">
                <button class="nav-link w-100 text-center" id="fill-tab" data-bs-toggle="tab" data-bs-target="#fill-mode"
                        type="button" role="tab" onclick="switchMode('fill')">
                    <i class="bi bi-file-earmark-text me-1"></i>
                    <span class="d-none d-sm-inline">Modo </span>Preenchimento
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="modeTabContent">

            <!-- Design Mode -->
            <div class="tab-pane fade show active" id="design-mode" role="tabpanel">
                <div class="row g-0">

                    <!-- Left Panel - Tools (Mobile Drawer) -->
                    <div class="col-lg-3 mobile-drawer" id="design-panel">
                        <div class="p-3 bg-white h-100 overflow-auto">

                            <!-- Upload PDF -->
                            <div class="card shadow-sm mb-3">
                                <div class="card-header bg-army-green text-white py-2">
                                    <h6 class="mb-0"><i class="bi bi-upload me-2"></i>1. Upload PDF</h6>
                                </div>
                                <div class="card-body p-3">
                                    <div class="upload-zone border border-2 border-dashed rounded p-3 text-center" id="upload-zone">
                                        <i class="bi bi-cloud-upload fs-2 text-muted"></i>
                                        <p class="text-muted mt-2 mb-2 small">Clique ou arraste PDF aqui</p>
                                        <input type="file" id="pdf-upload" accept=".pdf" class="d-none">
                                        <button onclick="document.getElementById('pdf-upload').click()"
                                                class="btn btn-sm btn-outline-success">
                                            <i class="bi bi-folder-open me-1"></i>Selecionar
                                        </button>
                                    </div>
                                    <div id="pdf-info" class="mt-2 small text-muted d-none"></div>
                                </div>
                            </div>

                            <!-- Field Library -->
                            <div class="card shadow-sm mb-3">
                                <div class="card-header bg-army-green text-white py-2">
                                    <h6 class="mb-0"><i class="bi bi-grid-3x3 me-2"></i>2. Tipos de Campo</h6>
                                </div>
                                <div class="card-body p-2">
                                    <div class="d-grid gap-2" id="field-library">
                                        <button class="field-type btn btn-outline-success text-start btn-sm" data-type="text">
                                            <i class="bi bi-input-cursor me-2"></i>Texto
                                        </button>
                                        <button class="field-type btn btn-outline-success text-start btn-sm" data-type="textarea">
                                            <i class="bi bi-textarea-t me-2"></i>Texto Longo
                                        </button>
                                        <button class="field-type btn btn-outline-success text-start btn-sm" data-type="checkbox">
                                            <i class="bi bi-check-square me-2"></i>Checkbox
                                        </button>
                                        <button class="field-type btn btn-outline-success text-start btn-sm" data-type="date">
                                            <i class="bi bi-calendar-date me-2"></i>Data
                                        </button>
                                        <button class="field-type btn btn-outline-success text-start btn-sm" data-type="signature">
                                            <i class="bi bi-pen me-2"></i>Assinatura
                                        </button>
                                        <button class="field-type btn btn-outline-success text-start btn-sm" data-type="image">
                                            <i class="bi bi-image me-2"></i>Imagem
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Save Template -->
                            <div class="card shadow-sm">
                                <div class="card-header bg-army-green text-white py-2">
                                    <h6 class="mb-0"><i class="bi bi-save me-2"></i>3. Salvar Template</h6>
                                </div>
                                <div class="card-body p-3">
                                    <input
                                        type="text"
                                        id="template-name"
                                        placeholder="Nome do template"
                                        class="form-control form-control-sm mb-2"
                                    >
                                    <button onclick="saveTemplate()" class="btn btn-success btn-sm w-100">
                                        <i class="bi bi-save me-2"></i>Salvar Template
                                    </button>
                                    <button onclick="exportTemplates()" class="btn btn-outline-secondary btn-sm w-100 mt-2">
                                        <i class="bi bi-download me-2"></i>Exportar Todos
                                    </button>
                                    <label class="btn btn-outline-secondary btn-sm w-100 mt-2 mb-0">
                                        <i class="bi bi-upload me-2"></i>Importar
                                        <input type="file" id="import-templates" accept=".json" class="d-none" onchange="importTemplates(event)">
                                    </label>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- Center Panel - Canvas -->
                    <div class="col-lg-6">
                        <div class="canvas-wrapper">
                            <div class="canvas-toolbar bg-white border-bottom p-2 d-flex justify-content-between align-items-center">
                                <div class="btn-group btn-group-sm" role="group">
                                    <button onclick="zoomOut()" class="btn btn-outline-secondary" title="Reduzir zoom">
                                        <i class="bi bi-dash-lg"></i>
                                    </button>
                                    <button class="btn btn-outline-secondary" disabled id="zoom-level">100%</button>
                                    <button onclick="zoomIn()" class="btn btn-outline-secondary" title="Aumentar zoom">
                                        <i class="bi bi-plus-lg"></i>
                                    </button>
                                </div>
                                <div class="btn-group btn-group-sm" role="group">
                                    <button onclick="toggleGrid()" class="btn btn-outline-secondary" id="grid-btn" title="Grade">
                                        <i class="bi bi-grid-3x3"></i>
                                    </button>
                                    <button onclick="clearFields()" class="btn btn-outline-danger" title="Limpar campos">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <div id="canvas-container" class="canvas-container">
                                <div id="pdf-canvas" class="pdf-canvas">
                                    <canvas id="pdf-render"></canvas>
                                    <div id="fields-overlay" class="fields-overlay"></div>
                                </div>
                                <div id="empty-canvas" class="empty-state">
                                    <div class="text-center">
                                        <i class="bi bi-file-earmark-pdf empty-icon"></i>
                                        <p class="fs-6 mt-3 text-muted">Faça upload de um PDF para começar</p>
                                        <button onclick="document.getElementById('pdf-upload').click()" 
                                                class="btn btn-success btn-sm">
                                            <i class="bi bi-upload me-2"></i>Upload PDF
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel - Field Properties -->
                    <div class="col-lg-3">
                        <div class="p-3 bg-white h-100 overflow-auto border-start">
                            
                            <!-- Field Properties Card -->
                            <div class="card shadow-sm" id="field-properties-panel">
                                <div class="card-header bg-army-green text-white py-2">
                                    <h6 class="mb-0"><i class="bi bi-sliders me-2"></i>Propriedades do Campo</h6>
                                </div>
                                <div class="card-body p-3" id="field-properties-content">
                                    <p class="text-muted text-center py-4 small">
                                        <i class="bi bi-info-circle me-2"></i>
                                        Selecione um campo para editar
                                    </p>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>
            </div>

            <!-- Fill Mode -->
            <div class="tab-pane fade" id="fill-mode" role="tabpanel">
                <div class="row g-0">

                    <!-- Left Panel - Form (Mobile Drawer) -->
                    <div class="col-lg-4 mobile-drawer" id="fill-panel">
                        <div class="p-3 bg-white h-100 overflow-auto">

                            <!-- Template Selector -->
                            <div class="card shadow-sm mb-3">
                                <div class="card-header bg-army-green text-white py-2">
                                    <h6 class="mb-0"><i class="bi bi-folder me-2"></i>1. Template</h6>
                                </div>
                                <div class="card-body p-3">
                                    <select id="template-selector" onchange="loadTemplate()" class="form-select form-select-sm mb-2">
                                        <option value="">Selecione um template...</option>
                                    </select>
                                    <div class="d-flex gap-2">
                                        <button onclick="duplicateCurrentTemplate()" id="btn-duplicate" disabled 
                                                class="btn btn-outline-secondary btn-sm flex-fill">
                                            <i class="bi bi-files"></i>
                                        </button>
                                        <button onclick="deleteCurrentTemplate()" id="btn-delete" disabled 
                                                class="btn btn-outline-danger btn-sm flex-fill">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Form Fields -->
                            <div class="card shadow-sm mb-3">
                                <div class="card-header bg-army-green text-white py-2 d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0"><i class="bi bi-pencil me-2"></i>2. Preencher</h6>
                                    <span id="fill-progress" class="badge bg-light text-dark small">0/0</span>
                                </div>
                                <div class="card-body p-3 form-fields-container">
                                    <div id="form-fields">
                                        <p class="text-muted text-center py-4 small">
                                            <i class="bi bi-info-circle me-2"></i>
                                            Selecione um template
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Actions -->
                            <div class="card shadow-sm">
                                <div class="card-header bg-army-green text-white py-2">
                                    <h6 class="mb-0"><i class="bi bi-file-pdf me-2"></i>3. Gerar PDF</h6>
                                </div>
                                <div class="card-body p-3">
                                    <button onclick="generatePDF()" id="btn-generate" disabled
                                            class="btn btn-success btn-sm w-100 mb-2">
                                        <i class="bi bi-download me-2"></i>Gerar e Baixar PDF
                                    </button>
                                    <button onclick="clearForm()" class="btn btn-outline-secondary btn-sm w-100">
                                        <i class="bi bi-x-circle me-2"></i>Limpar Formulário
                                    </button>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- Right Panel - Preview -->
                    <div class="col-lg-8">
                        <div class="canvas-wrapper">
                            <div class="canvas-toolbar bg-white border-bottom p-2 d-flex justify-content-between align-items-center">
                                <h6 class="mb-0 text-muted small">
                                    <i class="bi bi-eye me-2"></i>Preview
                                </h6>
                                <button onclick="togglePreviewZoom()" class="btn btn-sm btn-outline-secondary">
                                    <i class="bi bi-arrows-fullscreen"></i>
                                </button>
                            </div>
                            <div id="preview-container" class="canvas-container">
                                <div id="pdf-preview" class="pdf-canvas">
                                    <canvas id="pdf-preview-render"></canvas>
                                    <div id="preview-overlay" class="fields-overlay"></div>
                                </div>
                                <div id="empty-preview" class="empty-state">
                                    <div class="text-center">
                                        <i class="bi bi-eye-slash empty-icon"></i>
                                        <p class="fs-6 mt-3 text-muted">Selecione um template para ver o preview</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

        </div>

    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="toast" class="toast align-items-center" role="alert">
            <div class="d-flex">
                <div class="toast-body" id="toast-message"></div>
                <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    </div>

    <!-- Signature Pad Modal -->
    <div class="modal fade" id="signatureModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-army-green text-white">
                    <h5 class="modal-title"><i class="bi bi-pen me-2"></i>Assinar</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <canvas id="signature-canvas" class="signature-canvas border rounded"></canvas>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="clearSignature()">
                        <i class="bi bi-arrow-counterclockwise me-1"></i>Limpar
                    </button>
                    <button type="button" class="btn btn-success btn-sm" onclick="saveSignature()">
                        <i class="bi bi-check-lg me-1"></i>Salvar Assinatura
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Panel Overlay -->
    <div class="mobile-overlay" id="mobile-overlay"></div>

    <!-- Bootstrap 5.0 JS (Local) -->
    <script src="assets/js/bootstrap.bundle.min.js"></script>

    <!-- Custom App Logic -->
    <script src="app.js"></script>

</body>
</html>
